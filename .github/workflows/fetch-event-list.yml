name: Fetch Event List
on:
  schedule:
    - cron: '00 21 * * *' # UTC 21:00 (JST 06:00)
  workflow_dispatch:
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16.x'
      - name: Install Dependencies
        run: |
          yarn data build-dependencies
          yarn data
      - name: Fetch
        run: yarn data:fetch
      - name: Get Report
        id: report
        run: |
          content=$(cat packages/data/report.md)
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          echo ::set-output name=content::$content
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          title: 'イベント一覧を更新'
          body: ${{ steps.report.outputs.content }}
          branch: actions/update-event-list
          commit-message: |
            chore(data): イベント一覧を更新
          delete-branch: true
          reviewers: sya-ri
