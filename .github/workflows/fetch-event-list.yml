name: Fetch Event List
on:
  schedule:
    - cron: '00 21 * * *' # UTC 21:00 (JST 06:00)
  workflow_dispatch:
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
      - name: Install Dependencies
        run: |
          yarn install
      - name: Update event list
        run: yarn update
      - name: Get Report
        id: report
        run: |
          content=$(cat report.md)
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          echo ::set-output name=content::$content
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          title: 'イベント一覧を更新'
          body: ${{ steps.report.outputs.content }}
          branch: actions/update-event-list
          commit-message: |
            chore(data): イベント一覧を更新
          delete-branch: true
          reviewers: sya-ri
