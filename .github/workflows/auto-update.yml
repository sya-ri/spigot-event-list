name: Update Event List (Auto)
on:
  schedule:
    - cron: '00 21 * * *' # UTC 21:00 (JST 06:00)
  workflow_dispatch:
jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '14.x'
      - name: Cache node_modules
        uses: actions/cache@v2
        with:
          path: |
            node_modules
          key: node-v${{ matrix.node-version }}-deps-${{ hashFiles(format('{0}{1}', github.workspace, '/yarn.lock')) }}
      - name: Install Dependencies
        run: yarn
      - name: Run Update
        run: yarn run update
      - name: Get Report
        id: report
        run: |
          content=$(cat report.md)
          content="${content//'%'/'%25'}"
          content="${content//$'\n'/'%0A'}"
          content="${content//$'\r'/'%0D'}"
          echo ::set-output name=content::$content
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          title: 'イベントリストのバージョンを更新'
          body: ${{ steps.report.outputs.content }}
          branch: actions/update-event-list
          commit-message: 'イベントリストのバージョンを更新'
          delete-branch: true
          reviewers: sya-ri